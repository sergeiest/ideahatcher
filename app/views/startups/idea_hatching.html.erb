<%= render "startups/nav" %>

<div class="hatcher-container">
  <div class="company-main">
      <div class="company-content">
        <% @company_descriptions.each do |description| %>
            <div class="company-box">
                <h5><%= description.field_status %></h5>
                <% if description.companydescription_id %>
                    <div class="ab-test">
                        <% old_description = Companydescription.find(description.companydescription_id) %>
                        <img src="/images/arrowLeft.png" class="my_corner">
                        <div class="idea-statement current-test">
                            <%= simple_format Companydescription.find(description.companydescription_id).content.firstletters(340),
                                            :id => "p_old_"+ description.id.to_s() %>
                          <% old_description.approval_status = 0 if !old_description.approval_status %>
                          <p class="approval_status"><%= old_description.approval_status %> like this</p>
                        </div>
                        <img src="/images/vs.png" class="my_corner">
                        <div class="idea-statement next-test">
                            <%= simple_format description.content.firstletters(340), :id => "p_new_"+ description.id.to_s() %>
                            <% description.approval_status = 0 if !description.approval_status %>
                            <p class="approval_status"><%= description.approval_status %> like this</p>
                        </div>
                        <div class="clear-both"></div>
                      <input class="btn btn-mini" name="like_old" type="submit" value="I like this more" style="width:40%;margin-left:44px;"
                             onclick="changeButton(this, <%= old_description.id %>, 0 )"/>
                      <input class="btn btn-mini" name="like_new" type="submit" value="I like this more" style="width:40%;margin-left:40px;"
                             onclick="changeButton(this, <%= description.id %>, 1)"/>
                    </div>
                <% else %>
                    <div class="ab-test">
                        <div class="my_corner previous-test"></div>
                        <div class="idea-statement current-test">
                            <%= simple_format description.content.firstletters(340) %>
                        </div>
                        <div class="clear-both"></div>
                      </div>
                <% end %>

                <a onclick="showIdeas(this)" style="cursor:pointer; font-size:12px;">
                    Show/add suggestions <i class=' icon-chevron-down glyphw '></i>
                </a>
                <div name="ideas" hidden id="following_Idea<%= description.id %>">
                    <% @ideas.select{|a| a.companydescription_id == description.id }.each do |idea| %>
                        <%= simple_format idea.content %>
                        <div class="author">
                            <p><%= idea.first_name %> <%= idea.last_name %> on <%= idea.created_at.strftime('%m/%d/%Y') %></p>
                        </div>
                        <hr/>
                    <% end %>
                    <%= form_tag({:controller => "ideas", :action => "create"},
                                    :remote => true) do %>
                        <%= hidden_field :idea, :title, :value => description.field_status %>
                        <%= hidden_field :idea, :is_protected, :value => 0 %>
                        <%= hidden_field :idea, :idea_id, :value => "" %>
                        <%= hidden_field :idea, :startup_id, :value => @startup.id %>
                        <%= hidden_field :idea, :companydescription_id, :value => description.id %>
                        <%= text_area :idea, :content%>
                        <button class="btn btn-warning">Save</button>
                    <% end %>
                </div>
            </div>
        <% end %>
        <%=  form_tag({:controller => "likes", :action => "vote"},
                      :remote => true, :id => "send_vote", :hidden => true) do %>
            <%= hidden_field_tag :description_id, 0 %>
            <%= hidden_field_tag :add_vote, 3 %>
            <%= submit_tag 'Save', class: "btn btn-mini btn-primary"%>
        <% end %>
      </div>
    <div class="clear-both"></div>
  </div>
</div>



<script>

    function changeButton(elementNode, descriptionId, addValue){

        elementNode.disabled = true;
        elementNode.className = "btn btn-mini btn-primary";
        if (elementNode.name == "like_new") {
            sName = "like_old";
        } else {
            sName = "like_new";
        }
        notes = elementNode.parentNode.children;
        for (var i = 0; i < notes.length; i++) {
            if (notes[i].getAttribute('name') == sName) {
                notes[i].disabled = false;
                notes[i].className = "btn btn-mini";
            }
        }

        formNode = document.getElementById("send_vote");

        for (var i = 0; i < formNode.children.length; i++) {
            if (formNode.children[i].getAttribute('name') == "description_id") {
                formNode.children[i].value = descriptionId;
            }
            if (formNode.children[i].getAttribute('name') == "add_vote") {
                formNode.children[i].value = addValue;
            }
        }
        submitForm(formNode);

    }

    function showIdeas(elementNode) {
        notes = elementNode.parentNode.children;
        for (var i = 0; i < notes.length; i++) {
            if (notes[i].getAttribute('name') == "ideas") {
                ideasDiv = notes[i];
            }
        }
        if (ideasDiv.hidden == true) {
            elementNode.innerHTML = "Hide suggestions <i class=' icon-chevron-up glyphw '></i>";
            ideasDiv.hidden = false;
        } else {
            elementNode.innerHTML = "Show/add suggestions <i class=' icon-chevron-down glyphw '></i>";
            ideasDiv.hidden = true;
        }
    }
</script>
