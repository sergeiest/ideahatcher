<%= render "startups/nav" %>


<div class="hatcher-container">
  <div class="company-main">
    <div class="company-left">
      <div class="company-content">

        <div class="company-box">
          <h5>Hashtags</h5>
          <p>This is a simple way to let people know what your idea is about</p>
          <%= form_tag({:action => "add_tag", :controller => "tags"}, :remote => true, :class => "hashtag_form") do %>
            <%= text_field_tag :tag_name %>
            <%= hidden_field_tag :id, @startup.id %>
            <%= submit_tag "Add", :class => "btn btn-small" %>
          <% end %>
          <%= form_tag({:action => "delete_tag", :controller => "tags"}, :remote => true, :hidden => "true") do %>
            <%= hidden_field_tag :tag_id, 0 %>
            <%= hidden_field_tag :id, @startup.id %>
            <%= submit_tag "delete", :id => "delete_this_tag" %>
          <% end %>
          <hr/>
          <div id="hashtags">
            <% @tags.each do |tag| %>
              <div class="hashtag">#<%= tag.name %><span class="delete-tag" onclick="deleteTag(<%= tag.id %>, this)">x</span></div>
            <% end %>
          </div>
        </div>
      </div>


      <div class="company-box add-people">
          <h5>Choose who to share with:</h5>
          <p>Select people you want to share your idea with to receive feedback and advice.</p>
          <%
             circle_type = 0
             circle_type = 3 if @circles.any?{|x| x.id == 0}
             circle_type = 1 if circle_type == 0 and @circles.length > 0
          %>
          <%= form_tag({:action => "add_circle", :controller => "circles"},
                       :remote => 'true',
                       :onclick => 'submitForm(this)') do%>
              <p>
                <%= radio_button_tag :circle_status, 0, 1 if circle_type == 0%>
                <%= radio_button_tag :circle_status, 0 if circle_type != 0%>
                Do not share yet (you can share it later)
              </p>
              <p>
                <%= radio_button_tag :circle_status, 1, 1 if circle_type == 1%>
                <%= radio_button_tag :circle_status, 1 if circle_type != 1%>
                Select people yourself
              </p>
              <p>
                <%= radio_button_tag :circle_status, 2, 1 if circle_type == 2%>
                <%= radio_button_tag :circle_status, 2 if circle_type != 2%>
                Invite 20 random people
              </p>
              <p>
                <%= radio_button_tag :circle_status, 3, 1 if circle_type == 3%>
                <%= radio_button_tag :circle_status, 3 if circle_type != 3%>
                Share the idea with everyone
              </p>
              <%= hidden_field_tag :id, @startup.id %>
              <%= submit_tag "submit", :hidden => "true" %>
          <% end %>
          <div id="manual-selection" <%= "hidden" if [0, 3].include?circle_type %>>
            <hr/>
            <div class="people-to-add">
                <%= form_tag({:action => "search_people", :controller => "investors"},
                             :remote => true) do %>
                    <%= text_field_tag :string, "search", :onclick => "clearInput(this)", :onkeyup => "submitForm(this.parentNode)" %>
                    <%= hidden_field_tag :action_type, "add_circle" %>
                    <%= submit_tag "submit", :hidden => "true" %>
                <% end %>
                <%= form_tag({:action => "add_person", :controller => "circles"},
                             :remote => true,
                             :hidden => true,
                             :id => "add_person") do %>
                    <%= hidden_field_tag :user_id, 0 %>
                    <%= submit_tag "submit", :hidden => "true" %>
                <% end %>
                <%= form_tag({:action => "remove_person", :controller => "circles"},
                             :remote => true,
                             :hidden => true,
                             :id => "remove_person") do %>
                    <%= hidden_field_tag :user_id, 0 %>
                    <%= submit_tag "submit", :hidden => "true" %>
                <% end %>
                <div id="search-results">
                  <%= render :partial => "investors/people", :collection => @people,
                             :locals => {:action_type => "add_circle"} %>
                </div>
            </div>
            <div id="current-circle" class="people-added">
              <h4>People you have added:</h4>
              <% @circles.each do |person| %>
                  <%=  link_to({:controller => "investors", :action => "follower_info", :id => person.id, :action_type => "remove_circle"},
                            :remote => true) do %>
                      <div class="person-circle">
                        <% if  person.avatar? %>
                            <img src='<%= person.avatar.url(:square) %>' >
                        <% else %>
                            <img src='/images/profile/Nophoto.png'>
                        <% end %>
                        <h5><%= person.firstname %> <%= person.lastname %></h5>
                        <div class="clear-both"></div>
                      </div>
                  <% end %>
              <% end %>
            </div>

            <div class="clear-both"></div>
          </div>
      </div>

    </div>
    <div class="company-right">
      <div class="company-info">
        <h4>Team</h4>
        <%= render :partial => 'investors/person', :collection => @startup_owners, :locals => { :action_type => nil, :status => 1} %>
        <% if session[:connection_type]==2 %>
            <%= link_to 'Add more people >', {:controller => "startups", :action => "team", :id => params[:id]},
                        :class => "bottom-link" %>
        <% end %>
      </div>
      <div class="company-info">
        <h4>Followers</h4>
        <%= render :partial => 'investors/person', :collection => @startup_followers[0..7], :locals => { :action_type => nil, :status => 0} %>
        <%= link_to 'See all followers >', {:controller => "startups", :action => "followers", :id => @startup.id}, :class => "bottom-link" %>
      </div>
    </div>

    <div class="clear-both"></div>
  </div>
</div>


<div class="guideline-menu" onclick="showHelp(this)">
  <i class=' icon-question-sign glyphw ' style="float:left;"></i>
  <h5 hidden>What to do here</h5>
  <p hidden>The more the better. Select people you want to share the idea with and we will encourage them to give the feedback and advice</p>
</div>

<script>
    function deleteTag(id, element){
        document.getElementById("tag_id").value = id;
        element.hidden = true;
        document.getElementById("delete_this_tag").click();
    }

    function addPerson (elementNode, id) {
        var formElement = document.getElementById("add_person");
        var notes = formElement.children;
        for (var i = 0; i < notes.length; i++) {
            if (notes[i].getAttribute('name') == 'user_id') {
                notes[i].value = id;
            }
        }
        submitForm(formElement);
        $('#info_modal').modal('hide');
    }

    function removePerson (elementNode, id) {
        var formElement = document.getElementById("remove_person");
        var notes = formElement.children;
        for (var i = 0; i < notes.length; i++) {
            if (notes[i].getAttribute('name') == 'user_id') {
                notes[i].value = id;
            }
        }
        submitForm(formElement);
        $('#info_modal').modal('hide');
    }

</script>